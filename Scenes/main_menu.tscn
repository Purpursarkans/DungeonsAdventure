[gd_scene load_steps=3 format=3 uid="uid://bhnsy5o2jefqe"]

[ext_resource type="PackedScene" uid="uid://d03hsg8swu0rm" path="res://Scenes/player.tscn" id="1_ot5xp"]

[sub_resource type="GDScript" id="GDScript_4738c"]
resource_name = "MainMenu"
script/source = "extends Control


func _ready():
	pass

@export var ADRESS = \"127.0.0.1\"
@export var PORT = 25565
@export var playerScene : PackedScene


var peer = ENetMultiplayerPeer.new()


func _on_exit_button_down():
	get_tree().quit()

func _on_host_button_down():
	hide()
	peer.create_server(PORT)
	multiplayer.multiplayer_peer = peer
	multiplayer.peer_connected.connect(add_player)
	add_player()


func _on_connect_button_down():
	hide()
	peer.create_client(ADRESS,PORT)
	multiplayer.multiplayer_peer = peer
	pass # Replace with function body.



func add_player(id = 1):
	var player = playerScene.instantiate()
	player.name = str(id)
	$\"/root/game\".call_deferred(\"add_child\",player)
	
func exit_game(id):
	print_debug(id)
	multiplayer.peer_disconnected.connect(del_player)
	del_player(id)

func del_player(id):
	rpc(\"_del_player\",id)
	
@rpc(\"any_peer\",\"call_local\")
func _del_player(id):
	if id != null:
		$\"/root/game\".get_node(str(id)).queue_free()
"

[node name="MainMenu" type="Control"]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
script = SubResource("GDScript_4738c")
playerScene = ExtResource("1_ot5xp")

[node name="Host" type="Button" parent="."]
layout_mode = 0
anchor_left = 0.36875
anchor_top = 0.344444
anchor_right = 0.4875
anchor_bottom = 0.427778
text = "Host"
metadata/_edit_use_anchors_ = true

[node name="Connect" type="Button" parent="."]
layout_mode = 0
anchor_left = 0.36875
anchor_top = 0.45
anchor_right = 0.4875
anchor_bottom = 0.531944
text = "Connect"
metadata/_edit_use_anchors_ = true

[node name="Exit" type="Button" parent="."]
layout_mode = 0
anchor_left = 0.792969
anchor_top = 0.802778
anchor_right = 0.897656
anchor_bottom = 0.888889
text = "exit
"
metadata/_edit_use_anchors_ = true

[connection signal="button_down" from="Host" to="." method="_on_host_button_down"]
[connection signal="button_down" from="Connect" to="." method="_on_connect_button_down"]
[connection signal="button_down" from="Exit" to="." method="_on_exit_button_down"]
